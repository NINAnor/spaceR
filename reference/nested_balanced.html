<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Nested, balanced, and spatially well-spread stratified samples — nested_balanced • spaceR</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Nested, balanced, and spatially well-spread stratified samples — nested_balanced"><meta name="description" content="Draws a sequence of nested samples per stratum that are both
probability-balanced (via BalancedSampling) and well-spread in space.
The largest sample is drawn first; each subsequent (smaller) sample is drawn
from the previous sample only, but balanced against the auxiliary variables at
the level of the whole population, while spatial spreading is computed based on
the coordinated of the included population units only."><meta property="og:description" content="Draws a sequence of nested samples per stratum that are both
probability-balanced (via BalancedSampling) and well-spread in space.
The largest sample is drawn first; each subsequent (smaller) sample is drawn
from the previous sample only, but balanced against the auxiliary variables at
the level of the whole population, while spatial spreading is computed based on
the coordinated of the included population units only."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">spaceR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Nested, balanced, and spatially well-spread stratified samples</h1>

      <div class="d-none name"><code>nested_balanced.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Draws a sequence of <strong>nested</strong> samples per stratum that are both
probability-balanced (via <span class="pkg">BalancedSampling</span>) and well-spread in space.
The largest sample is drawn first; each subsequent (smaller) sample is drawn
<em>from the previous sample only</em>, but balanced against the auxiliary variables at
the level of the whole population, while spatial spreading is computed based on
the coordinated of the included population units only.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">nested_balanced</span><span class="op">(</span></span>
<span>  <span class="va">samplingFrame</span>,</span>
<span>  <span class="va">n_seq</span>,</span>
<span>  id_col <span class="op">=</span> <span class="st">"ID"</span>,</span>
<span>  stratum_col <span class="op">=</span> <span class="st">"stratum"</span>,</span>
<span>  easting_col <span class="op">=</span> <span class="st">"Easting"</span>,</span>
<span>  northing_col <span class="op">=</span> <span class="st">"Northing"</span>,</span>
<span>  area_col <span class="op">=</span> <span class="st">"area"</span>,</span>
<span>  xbal_formula <span class="op">=</span> <span class="op">~</span><span class="fl">1</span>,</span>
<span>  exclude_offset <span class="op">=</span> <span class="fl">1e+06</span>,</span>
<span>  return_dataframe <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  out_name <span class="op">=</span> <span class="st">"mysample"</span>,</span>
<span>  safetyNumber <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  auto_n <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  min_step <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-samplingframe">samplingFrame<a class="anchor" aria-label="anchor" href="#arg-samplingframe"></a></dt>
<dd><p>A <code>data.frame</code> (your population of sampling units, e.g. <code>mypop</code>).</p></dd>


<dt id="arg-n-seq">n_seq<a class="anchor" aria-label="anchor" href="#arg-n-seq"></a></dt>
<dd><p>Numeric vector of desired <strong>per-stratum</strong> sample sizes in
decreasing order, e.g. <code>c(100, 80, 60, 40, 20)</code>. The first element is the
largest (top-level) sample; each subsequent element is a nested subsample
of the previous. If auto_n is TRUE (which is the default), then only two values are needed; a
start and a stop values (i.e. c(100, 10)).</p></dd>


<dt id="arg-id-col">id_col<a class="anchor" aria-label="anchor" href="#arg-id-col"></a></dt>
<dd><p>Name of the ID column in <code>samplingFrame</code>. Default <code>"ID"</code>. Needs to be unique to each population unit.</p></dd>


<dt id="arg-stratum-col">stratum_col<a class="anchor" aria-label="anchor" href="#arg-stratum-col"></a></dt>
<dd><p>Name of the stratum column in <code>samplingFrame</code>. Default <code>"stratum"</code>.</p></dd>


<dt id="arg-easting-col">easting_col<a class="anchor" aria-label="anchor" href="#arg-easting-col"></a></dt>
<dd><p>Name of the easting (x) coordinate column. Default <code>"Easting"</code>.</p></dd>


<dt id="arg-northing-col">northing_col<a class="anchor" aria-label="anchor" href="#arg-northing-col"></a></dt>
<dd><p>Name of the northing (y) coordinate column. Default <code>"Northing"</code>.</p></dd>


<dt id="arg-area-col">area_col<a class="anchor" aria-label="anchor" href="#arg-area-col"></a></dt>
<dd><p>Name of the area/size measure column used to set inclusion
probabilities within stratum (your <code>area</code>). Default <code>"area"</code>. If you are not using
sampling with probabilities proportional to size, then <code>area_col</code> might just be
the population or strata size <em>N</em>.</p></dd>


<dt id="arg-xbal-formula">xbal_formula<a class="anchor" aria-label="anchor" href="#arg-xbal-formula"></a></dt>
<dd><p>A right-hand-side formula for the balancing variables,
evaluated on <code>samplingFrame</code>, e.g. <code>~ aux1 + aux2 - 1</code>. Default <code>~ 1</code> (no balancing
auxiliaries beyond spreading/strata).</p></dd>


<dt id="arg-exclude-offset">exclude_offset<a class="anchor" aria-label="anchor" href="#arg-exclude-offset"></a></dt>
<dd><p>Numeric offset added to the max of each coordinate to
push excluded units <em>far away</em> for the spreading step. Default <code>1e6</code>.</p></dd>


<dt id="arg-return-dataframe">return_dataframe<a class="anchor" aria-label="anchor" href="#arg-return-dataframe"></a></dt>
<dd><p>Logical; if <code>TRUE</code>, also returns a filtered sampling frame, with all columns,
instead of just the populatio units ID's. Default <code>FALSE</code>.</p></dd>


<dt id="arg-safetynumber">safetyNumber<a class="anchor" aria-label="anchor" href="#arg-safetynumber"></a></dt>
<dd><p>Numeric; constant which is subtracted from difference between the current n
(for a given sample) and the remaining area, in order to keep probabilities above 1. Default is 1,
and the parameter normally don't need to be altered.</p></dd>


<dt id="arg-auto-n">auto_n<a class="anchor" aria-label="anchor" href="#arg-auto-n"></a></dt>
<dd><p>Logical; if the function should try to find the smallest possible step (but still larger than
'min_step') that still produces inclusion probabilities &lt; 1. Default is TRUE, and then the n_seq can be
set to just two numbers, a start and a stop value. If FALSE, then the n is given ny 'n_seq'.</p></dd>


<dt id="arg-min-step">min_step<a class="anchor" aria-label="anchor" href="#arg-min-step"></a></dt>
<dd><p>Numeric;, the minimal reduction in n between subsequent samples. Default is 10.</p></dd>


<dt id="arg-mysample">mysample<a class="anchor" aria-label="anchor" href="#arg-mysample"></a></dt>
<dd><p>Character; text to be prepended to the sample names, followed by the sample size.
Default to 'mysample' which will name the output like 'mysample_n' where n is the sample size.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A named list of lists. For each <code>n</code> you get an element named
<code>mysample{n}</code> (e.g. <code>wetlands_100</code>, <code>wetlands_80</code>, ...), each containing a list of population ID's,
and a list of inclusion probabilities, which are the accumulated probabilities. This means that if the
probability of a unit in the initial sample is 0.1, and in the second sample it was 0.9, then the accumulated
probaili is 0.09. If <code>return_dataframe = TRUE</code> a <code>data.frame</code> with the rows
of <code>samplingFrame</code> that were selected.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>For each requested sample size <code>n</code> (per stratum), the function sets inclusion
probabilities \(\pi_i = n \cdot a_i / \sum_{h} a_i\) within each stratum
using the <code>area_col</code> values \(a_i\). For the first draw this sum is taken
over the entire stratum; for subsequent draws it is taken over the <em>previous</em>
sample only, so that samples are nested. Spatial spreading uses <code>Xspread</code>
(Easting/Northing). Units not available in the current step are assigned
coordinates far outside the study area to avoid influencing the spread.</p>
<p>Requires <span class="pkg">BalancedSampling</span>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Suppose mypop has: ID, stratum, Easting, Northing, area2, aux1, aux2</span></span></span>
<span class="r-in"><span><span class="co"># We want nested samples of sizes 100, 80, 60, 40, 20 per stratum:</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">mypop</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">nested_balanced</span><span class="op">(</span></span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">mypop</span>,</span></span>
<span class="r-in"><span>  n_seq <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">80</span>, <span class="fl">60</span>, <span class="fl">40</span>, <span class="fl">20</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  id_col <span class="op">=</span> <span class="st">"ID"</span>,</span></span>
<span class="r-in"><span>  stratum_col <span class="op">=</span> <span class="st">"stratum"</span>,</span></span>
<span class="r-in"><span>  easting_col <span class="op">=</span> <span class="st">"Easting"</span>,</span></span>
<span class="r-in"><span>  northing_col <span class="op">=</span> <span class="st">"Northing"</span>,</span></span>
<span class="r-in"><span>  area_col <span class="op">=</span> <span class="st">"area2"</span>,</span></span>
<span class="r-in"><span>  xbal_formula <span class="op">=</span> <span class="op">~</span> <span class="va">aux1</span> <span class="op">+</span> <span class="va">aux2</span> <span class="op">-</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>  auto_n <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>  mysample <span class="op">=</span> <span class="st">"sample"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Access the largest and a nested subset:</span></span></span>
<span class="r-in"><span><span class="va">sample_100</span> <span class="op">&lt;-</span> <span class="va">out</span><span class="op">$</span><span class="va">mysample_100</span></span></span>
<span class="r-in"><span><span class="va">sample_60</span>  <span class="op">&lt;-</span> <span class="va">out</span><span class="op">$</span><span class="va">mysample_60</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Anders Kolstad.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

